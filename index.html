<!DOCTYPE html>
<html lang="es" style="background-color: #2d0c51;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DNPlus Py - Edición Premium</title>
    <style>
        html, body { background-color: #2d0c51 !important; }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700;900&display=swap');

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #2d0c51;
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* --- EFECTOS DE FONDO --- */
        .effect-layer { position: absolute; inset: 0; z-index: 0; opacity: 0; pointer-events: none; transition: opacity 0.8s ease-in-out; }
        .bg-effect-neon { background: radial-gradient(circle at 50% 50%, rgba(130, 232, 242, 0.3) 0%, transparent 70%); animation: pulseNeon 2s infinite alternate ease-in-out; }
        .bg-effect-aurora { background: linear-gradient(270deg, #2d0c51, #4a148c, #00d2ff, #ff00ff); background-size: 400% 400%; animation: auroraFlow 8s infinite ease-in-out; }
        .bg-effect-stars { background-image: radial-gradient(2px 2px at 40px 60px, #fff, transparent), radial-gradient(2px 2px at 150px 150px, #82E8F2, transparent); background-size: 200px 200px; animation: starsAnim 4s linear infinite; }
        .bg-effect-plasma { background: radial-gradient(circle at 20% 30%, #ff00ff 0%, transparent 50%), radial-gradient(circle at 80% 70%, #00ffff 0%, transparent 50%); filter: blur(60px); animation: plasmaMove 6s infinite alternate linear; }
        .bg-effect-digital { background: repeating-linear-gradient(0deg, rgba(0, 255, 65, 0.1) 0px, rgba(0, 255, 65, 0.1) 1px, transparent 1px, transparent 2px); background-size: 100% 3px; animation: scanline 10s linear infinite; }
        .bg-effect-sunset { background: linear-gradient(45deg, rgba(255, 0, 150, 0.2), rgba(255, 165, 0, 0.2)); animation: sunsetFade 3s infinite alternate; }
        .effect-active { opacity: 1 !important; }

        @keyframes pulseNeon { from { transform: scale(1); opacity: 0.2; } to { transform: scale(1.3); opacity: 0.5; } }
        @keyframes auroraFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes starsAnim { from { transform: translateY(0); opacity: 0.5; } to { transform: translateY(-200px); opacity: 1; } }
        @keyframes plasmaMove { 0% { transform: translate(0,0) scale(1); } 50% { transform: translate(20px, -20px) scale(1.2); } 100% { transform: translate(-20px, 20px) scale(1); } }
        @keyframes scanline { from { background-position: 0 0; } to { background-position: 0 100%; } }
        @keyframes sunsetFade { from { filter: hue-rotate(0deg); opacity: 0.3; } to { filter: hue-rotate(90deg); opacity: 0.6; } }

        /* --- PLAYER UI --- */
        .logo-box { width: 180px; height: 180px; border: 4px solid #82E8F2; border-radius: 50%; object-fit: cover; transition: all 0.3s ease; box-shadow: 0 0 25px rgba(130, 232, 242, 0.3); z-index: 10; }
        .logo-playing { animation: logoPulse 1s infinite alternate; }
        @keyframes logoPulse { 0% { border-radius: 50%; transform: scale(1); } 100% { border-radius: 30px; transform: scale(1.03); } }

        .brand-main {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900; font-size: 30px; letter-spacing: 2px;
            background: linear-gradient(to bottom, #FFD700 0%, #B8860B 50%, #FFD700 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.6)); margin-top: 15px; z-index: 10;
        }

        .live-status {
            font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 15px; color: #FF69B4;
            text-transform: uppercase; letter-spacing: 4px; text-shadow: 2px 2px 5px rgba(255, 105, 180, 0.7);
            margin-bottom: 25px; z-index: 10;
        }

        .track-board { width: 95%; background: transparent; overflow: hidden; white-space: nowrap; margin: 10px 0; z-index: 10; }
        .track-title { display: inline-block; font-family: 'Orbitron', sans-serif; font-size: 24px; font-weight: 900; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); text-transform: uppercase; padding-left: 100%; animation: marquee 12s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .visualizer-container { height: 60px; width: 100%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; z-index: 10; }
        canvas#visualizerCanvas { width: 100%; height: 60px; }

        .float-timer-btn { 
            position: fixed; bottom: 30px; right: 30px; width: 45px; height: 45px; 
            background: #2d0b53; border: 2px solid #82E8F2; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #82E8F2; font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6); z-index: 100;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .timer-badge { position: absolute; top: -5px; right: -5px; background: white; color: black; font-size: 10px; font-weight: 900; padding: 2px 6px; border-radius: 10px; display: none; }
        .timer-running .timer-badge { display: block; }
        .timer-running { background: #ff4500 !important; color: white !important; border-color: #ffffff !important; animation: heartBeat 1.5s infinite; }
        @keyframes heartBeat { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }

        /* --- MODALES --- */
        .modal-container { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1000; 
            display: none; align-items: center; justify-content: center; padding: 25px;
            backdrop-filter: blur(8px);
        }
        .modal-container.active { display: flex; animation: modalIn 0.3s ease-out; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .modal-content {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #00f2fe; border-radius: 30px; width: 100%; max-width: 400px;
            padding: 30px; position: relative; box-shadow: 0 0 50px rgba(0, 242, 254, 0.2);
            max-height: 85vh; overflow-y: auto;
        }

        .close-modal {
            position: absolute; top: -15px; right: -15px;
            width: 40px; height: 40px; background: #00f2fe; color: #000;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: 900; cursor: pointer;
        }

        /* --- MENÚ LATERAL --- */
        .drawer {
            position: fixed; top: 0; left: 0; width: 280px; height: 100%;
            background: linear-gradient(135deg, #1e0b3b 0%, #0a0a1a 100%);
            z-index: 200; transform: translateX(-100%); 
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; border-right: 1px solid rgba(130, 232, 242, 0.1);
        }
        .drawer.active { transform: translateX(0); }
        .drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; z-index: 190; backdrop-filter: blur(8px); }
        .drawer-overlay.active { display: block; }

        .social-card {
            display: flex; align-items: center; gap: 12px; background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05); padding: 8px 12px; border-radius: 12px;
            cursor: pointer; transition: all 0.2s ease; margin-bottom: 8px;
        }
        .social-card:active { transform: scale(0.97); background: rgba(130, 232, 242, 0.1); }
        .social-card i { font-size: 18px; width: 24px; text-align: center; }
        .social-card span { font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.8); }

        .siguenos-title {
            font-family: 'Orbitron', sans-serif; font-size: 10px; text-transform: uppercase;
            letter-spacing: 3px; color: #82E8F2; text-align: center; margin: 20px 0 15px 0;
            opacity: 0.8; position: relative; display: flex; align-items: center; justify-content: center;
        }
        .siguenos-title::before, .siguenos-title::after {
            content: ""; height: 1px; width: 30px; background: linear-gradient(to right, transparent, #82E8F2); margin: 0 10px;
        }
        .siguenos-title::after { background: linear-gradient(to left, transparent, #82E8F2); }

        #volumeSlider { -webkit-appearance: none; width: 100%; height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; outline: none; }
        #volumeSlider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #82E8F2; border-radius: 50%; cursor: pointer; }

        .custom-timer-input {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 242, 254, 0.3);
            border-radius: 12px; color: white; padding: 12px; width: 100%; text-align: center;
            font-family: 'Roboto', sans-serif; font-size: 14px; margin-bottom: 15px; outline: none;
        }
    </style>
</head>
<body>

    <!-- CAPAS DE FONDO -->
    <div id="fx0" class="effect-layer" style="background-color: #2d0c51;"></div>
    <div id="fx1" class="effect-layer bg-effect-neon"></div>
    <div id="fx2" class="effect-layer bg-effect-aurora"></div>
    <div id="fx3" class="effect-layer bg-effect-stars"></div>
    <div id="fx4" class="effect-layer bg-effect-plasma"></div>
    <div id="fx5" class="effect-layer bg-effect-digital"></div>
    <div id="fx6" class="effect-layer bg-effect-sunset"></div>

    <div id="overlay" class="drawer-overlay" onclick="toggleMenu()"></div>

    <header class="w-full p-4 flex justify-between items-center z-20">
        <button onclick="toggleMenu()" class="w-12 h-12 bg-gray-600/30 rounded-full flex items-center justify-center text-cyan-400 backdrop-blur-md">
            <i class="fa-solid fa-bars-staggered text-xl"></i>
        </button>
        <button onclick="shareApp()" class="w-12 h-12 bg-gray-600/30 rounded-full flex items-center justify-center text-cyan-400 backdrop-blur-md">
            <i class="fa-solid fa-share-nodes"></i>
        </button>
    </header>

    <main class="flex-grow flex flex-col items-center justify-start w-full px-6 text-center z-10">
        <div class="mt-0 relative">
             <img id="logo" src="https://i.postimg.cc/T15CvvVp/Rounded-20251202-211434.png" class="logo-box">
        </div>
        <div class="brand-main">DNPlus Py</div>
        <div class="live-status">Radio en vivo</div>
        <div class="track-board">
            <div id="track-text" class="track-title">DNPlus Py - Calidad Digital HD - Paraguay al Mundo - </div>
        </div>
        
        <div class="visualizer-container">
            <canvas id="visualizerCanvas"></canvas>
        </div>
        
        <div class="w-full max-w-xs flex items-center gap-4 mb-8">
            <i class="fa-solid fa-volume-off text-xs opacity-50"></i>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
            <i class="fa-solid fa-volume-high text-xs opacity-50"></i>
        </div>

        <div class="flex items-center justify-center gap-10">
            <div id="fxBtn" class="w-10 h-10 cursor-pointer flex items-center justify-center" onclick="nextEffect()">
                <svg viewBox="0 0 24 24" fill="white" class="w-full h-full"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6zm-2 16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
            </div>
            <button onclick="togglePlayback()" class="active:scale-90 transition-all">
                <img id="playIcon" src="https://i.postimg.cc/sXLXD4BJ/play.png" style="width: 105px; height: 105px;">
            </button>
            <img id="liveIndicator" src="https://i.postimg.cc/z3mYvg2R/live-stream.png" class="w-12 h-12 opacity-40">
        </div>
    </main>

    <!-- BOTÓN PROGRAMADOR -->
    <div id="timerBtn" class="float-timer-btn" onclick="openWidget('timer-modal')">
        <i class="fa-solid fa-clock"></i>
        <span id="timerBadge" class="timer-badge">00</span>
    </div>

    <!-- MODALES -->
    <div id="timer-modal" class="modal-container">
        <div class="modal-content text-center">
            <div class="close-modal" onclick="closeWidget('timer-modal')"><i class="fa-solid fa-xmark"></i></div>
            <i class="fa-solid fa-hourglass-half text-5xl text-cyan-400 mb-6"></i>
            <h2 class="font-['Orbitron'] text-xl mb-6 text-white font-black tracking-widest">DORMIR RADIO</h2>
            <div id="timer-active-ui" class="hidden mb-6">
                <p id="remaining-time" class="text-5xl text-white font-black mb-6">00:00</p>
                <button onclick="cancelTimer()" class="bg-red-600 text-white w-full py-3 rounded-xl font-bold uppercase tracking-widest">CANCELAR</button>
            </div>
            <div id="timer-setup-ui">
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <button onclick="setTimer(15)" class="bg-white/5 hover:bg-cyan-400/20 py-3 rounded-xl text-white font-bold text-sm">15m</button>
                    <button onclick="setTimer(30)" class="bg-white/5 hover:bg-cyan-400/20 py-3 rounded-xl text-white font-bold text-sm">30m</button>
                    <button onclick="setTimer(60)" class="bg-white/5 hover:bg-cyan-400/20 py-3 rounded-xl text-white font-bold text-sm">1h</button>
                </div>
                <div class="mt-4 pt-4 border-t border-white/10">
                    <p class="text-[10px] text-white/40 uppercase tracking-widest mb-3">Tiempo personalizado (minutos)</p>
                    <input type="number" id="customMinutes" class="custom-timer-input" placeholder="Ej: 120" min="1">
                    <button onclick="applyCustomTimer()" class="bg-cyan-400 text-black w-full py-3 rounded-xl font-black uppercase tracking-widest text-xs">PROGRAMAR AHORA</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: PRIVACIDAD EXTENDIDA -->
    <div id="privacy-modal" class="modal-container">
        <div class="modal-content">
            <div class="close-modal" onclick="closeWidget('privacy-modal')"><i class="fa-solid fa-xmark"></i></div>
            <h2 class="font-['Orbitron'] text-xl mb-4 text-cyan-400 font-black tracking-widest border-b border-cyan-400/20 pb-4">POLÍTICA DE PRIVACIDAD</h2>
            <div class="text-white/80 text-[12px] space-y-4 leading-relaxed text-justify pr-2">
                <p>Bienvenido a <strong class="text-cyan-400">DNPlus Py</strong>. Tu privacidad es fundamental para nosotros. Esta política describe cómo manejamos la información dentro de nuestra aplicación móvil.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">1. Recolección de Datos</h3>
                <p>Nuestra aplicación ha sido desarrollada bajo el principio de "Privacidad por Diseño". <strong class="text-white">No recolectamos, almacenamos ni procesamos ningún dato personal identificable</strong> como nombres, números de teléfono, correos electrónicos o ubicaciones GPS.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">2. Uso de la Red</h3>
                <p>Para funcionar correctamente, la App requiere acceso a Internet con el fin de recibir el flujo de audio (streaming). Durante este proceso, se pueden transmitir datos técnicos básicos (como dirección IP) al servidor de streaming (ZenoMedia), lo cual es inherente al funcionamiento de cualquier transmisión online. Estos datos no son utilizados para seguimiento comercial.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">3. Cookies y Tecnologías Similares</h3>
                <p>DNPlus Py no utiliza cookies de seguimiento ni herramientas de análisis de terceros para rastrear tu comportamiento o crear perfiles de usuario.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">4. Enlaces a Terceros</h3>
                <p>Nuestra aplicación contiene botones que enlazan a plataformas externas como WhatsApp, Facebook, Telegram, TikTok y YouTube. Al interactuar con estos botones, serás redirigido a sus respectivas aplicaciones o sitios web, los cuales cuentan con sus propias políticas de privacidad sobre las que no tenemos control.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">5. Permisos de la App</h3>
                <p>Solicitamos únicamente los permisos necesarios para la reproducción multimedia. En dispositivos Android, esto incluye mantener la conexión activa mientras la pantalla está bloqueada (Wake Lock) para evitar interrupciones en la radio.</p>
                
                <h3 class="text-white font-bold uppercase text-[10px] tracking-widest">6. Cambios en esta Política</h3>
                <p>Nos reservamos el derecho de actualizar esta política en cualquier momento para reflejar mejoras técnicas o cambios legales. Se recomienda revisar esta sección periódicamente.</p>
                
                <p class="text-[10px] pt-4 opacity-40 text-center border-t border-white/5 mt-4 uppercase">Última actualización: 29 de Diciembre, 2025</p>
            </div>
            <button onclick="closeWidget('privacy-modal')" class="mt-6 bg-cyan-400 text-black w-full py-3 rounded-xl font-black uppercase tracking-widest text-xs shadow-[0_0_15px_rgba(0,242,254,0.4)]">ACEPTAR Y CERRAR</button>
        </div>
    </div>

    <!-- MENÚ LATERAL -->
    <div id="drawer" class="drawer">
        <div class="p-4 flex flex-col items-center border-b border-white/5">
            <div class="w-full flex justify-end mb-1">
                <button onclick="toggleMenu()" class="text-white/40 text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <img src="https://i.postimg.cc/T15CvvVp/Rounded-20251202-211434.png" class="w-16 h-16 rounded-xl shadow-2xl border border-white/10">
            <h1 class="mt-4 font-black text-white tracking-[4px] text-[12px] font-['Orbitron']">DNPLUS PY</h1>
        </div>
        <div class="flex-grow overflow-y-auto px-5 py-2">
            <div class="siguenos-title">Síguenos</div>
            
            <div onclick="openUrl('https://api.whatsapp.com/send?phone=595992536184')" class="social-card">
                <i class="fa-brands fa-whatsapp text-green-400"></i><span>WhatsApp</span>
            </div>
            <div onclick="openUrl('https://www.facebook.com/profile.php?id=61578235681061')" class="social-card">
                <i class="fa-brands fa-facebook text-blue-500"></i><span>Facebook</span>
            </div>
            <div onclick="openUrl('https://t.me/dnchats_Ms')" class="social-card">
                <i class="fa-brands fa-telegram text-sky-400"></i><span>Telegram</span>
            </div>
            <div onclick="openUrl('https://www.tiktok.com/@davidysugrupo')" class="social-card">
                <i class="fa-brands fa-tiktok text-white"></i><span>TikTok</span>
            </div>
            <div onclick="openUrl('https://www.youtube.com/@davidysugrupotropical')" class="social-card">
                <i class="fa-brands fa-youtube text-red-600"></i><span>YouTube</span>
            </div>
        </div>
        <div class="p-6 border-t border-white/5">
            <div onclick="openPrivacy()" class="text-center text-[10px] text-cyan-400 font-bold uppercase tracking-widest cursor-pointer hover:text-white">Política de Privacidad</div>
            <p class="text-[8px] text-center text-white/20 mt-2 tracking-[3px]">DN PREMIUM V4.6.2</p>
        </div>
    </div>

    <audio id="radio" src="https://stream.zeno.fm/g2jfwe9xd1bvv" crossorigin="anonymous" preload="auto"></audio>

    <script>
        const audio = document.getElementById('radio');
        const playIcon = document.getElementById('playIcon');
        const volSlider = document.getElementById('volumeSlider');
        const canvas = document.getElementById('visualizerCanvas');
        const ctx = canvas.getContext('2d');
        const timerBtn = document.getElementById('timerBtn');

        let isPlaying = false, currentFx = 1, sleepTimerId = null, sleepIntervalId = null, totalSecondsRemaining = 0;
        let audioCtx, analyser, source, dataArray, animationId, hueOffset = 0;

        function updateMediaSession() {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: 'DNPlus Py',
                    artist: 'Radio en Vivo',
                    album: 'Paraguay al Mundo',
                    artwork: [{ src: 'https://i.postimg.cc/T15CvvVp/Rounded-20251202-211434.png', sizes: '512x512', type: 'image/png' }]
                });
                navigator.mediaSession.setActionHandler('play', togglePlayback);
                navigator.mediaSession.setActionHandler('pause', togglePlayback);
            }
        }

        function openWidget(id) { document.getElementById(id).classList.add('active'); }
        function closeWidget(id) { document.getElementById(id).classList.remove('active'); }
        function openPrivacy() { toggleMenu(); openWidget('privacy-modal'); }

        function openUrl(url) {
            window.open(url, '_system'); 
            window.location.href = url;
        }

        function setTimer(minutes) {
            cancelTimer();
            totalSecondsRemaining = minutes * 60;
            timerBtn.classList.add('timer-running');
            document.getElementById('timerBadge').innerText = minutes > 99 ? '99+' : minutes;
            sleepTimerId = setTimeout(() => { if (isPlaying) togglePlayback(); cancelTimer(); }, totalSecondsRemaining * 1000);
            sleepIntervalId = setInterval(() => {
                totalSecondsRemaining--;
                const mins = Math.floor(totalSecondsRemaining / 60);
                const secs = totalSecondsRemaining % 60;
                document.getElementById('remaining-time').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                document.getElementById('timerBadge').innerText = (mins + 1) > 99 ? '99+' : (mins + 1);
                if (totalSecondsRemaining <= 0) cancelTimer();
            }, 1000);
            document.getElementById('timer-setup-ui').classList.add('hidden');
            document.getElementById('timer-active-ui').classList.remove('hidden');
        }

        function cancelTimer() {
            if (sleepTimerId) clearTimeout(sleepTimerId);
            if (sleepIntervalId) clearInterval(sleepIntervalId);
            sleepTimerId = null; sleepIntervalId = null;
            timerBtn.classList.remove('timer-running');
            document.getElementById('timer-setup-ui').classList.remove('hidden');
            document.getElementById('timer-active-ui').classList.add('hidden');
        }

        function initAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                source = audioCtx.createMediaElementSource(audio);
                source.connect(analyser); analyser.connect(audioCtx.destination);
                analyser.fftSize = 128; dataArray = new Uint8Array(analyser.frequencyBinCount);
            }
        }

        function drawVisualizer() {
            animationId = requestAnimationFrame(drawVisualizer);
            analyser.getByteFrequencyData(dataArray);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const barWidth = (canvas.width / dataArray.length) * 2.5;
            let x = 0; hueOffset += 2;
            for (let i = 0; i < dataArray.length; i++) {
                const barHeight = (dataArray[i] / 255) * canvas.height;
                ctx.fillStyle = `hsl(${(i / dataArray.length * 360) + hueOffset % 360}, 100%, 60%)`;
                ctx.beginPath();
                if(ctx.roundRect) ctx.roundRect(x, canvas.height - barHeight, barWidth - 4, barHeight, 5);
                else ctx.rect(x, canvas.height - barHeight, barWidth - 4, barHeight);
                ctx.fill();
                x += barWidth;
            }
        }

        function togglePlayback() {
            if (!isPlaying) {
                initAudioContext(); if (audioCtx.state === 'suspended') audioCtx.resume();
                audio.play().then(() => {
                    updateMediaSession();
                    if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
                }).catch(e => console.error(e));
                playIcon.src = "https://i.postimg.cc/Y2J6d1Xz/pause-(1).png";
                document.getElementById('logo').classList.add('logo-playing');
                isPlaying = true; drawVisualizer();
            } else {
                audio.pause();
                if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
                playIcon.src = "https://i.postimg.cc/sXLXD4BJ/play.png";
                document.getElementById('logo').classList.remove('logo-playing');
                isPlaying = false; cancelAnimationFrame(animationId);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        function nextEffect() { 
            currentFx = (currentFx + 1) % 7; 
            document.querySelectorAll('.effect-layer').forEach(el => el.classList.remove('effect-active'));
            document.getElementById('fx' + currentFx).classList.add('effect-active');
        }

        function toggleMenu() {
            document.getElementById('drawer').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function shareApp() {
            const url = 'https://www.mediafire.com/file/c5vmtub0j0jhs0w/DNPlus_Py.apk/file';
            if (navigator.share) navigator.share({ title: 'DNPlus Py', url }); else openUrl(url);
        }

        volSlider.addEventListener('input', (e) => audio.volume = e.target.value);
        window.onload = () => {
            document.getElementById('fx' + currentFx).classList.add('effect-active');
            canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
        };
    </script>
</body>
</html>